<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detached DOM Nodes í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        line-height: 1.6;
      }

      .controls {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin: 5px;
      }

      button:hover {
        background: #0056b3;
      }

      button.danger {
        background: #dc3545;
      }

      button.danger:hover {
        background: #c82333;
      }

      button.success {
        background: #28a745;
      }

      button.success:hover {
        background: #218838;
      }

      .info {
        background: #e7f3ff;
        padding: 15px;
        border-left: 4px solid #007bff;
        margin: 20px 0;
        border-radius: 4px;
      }

      .warning {
        background: #fff3cd;
        padding: 15px;
        border-left: 4px solid #ffc107;
        margin: 20px 0;
        border-radius: 4px;
      }

      .stats {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin: 20px 0;
      }

      #container {
        min-height: 200px;
        border: 2px dashed #ccc;
        padding: 20px;
        border-radius: 4px;
        margin: 20px 0;
      }

      .node-item {
        background: white;
        border: 1px solid #dee2e6;
        padding: 15px;
        margin: 10px 0;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      code {
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
      }

      ol {
        padding-left: 20px;
      }

      ol li {
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” Detached DOM Nodes ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í…ŒìŠ¤íŠ¸</h1>

    <div class="info">
      <strong>ì´ ì˜ˆì œëŠ” ë¬´ì—‡ì„ í•˜ë‚˜ìš”?</strong>
      <p>
        DOMì—ì„œ ì œê±°ëœ ë…¸ë“œë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë°°ì—´ì— ê³„ì† ì°¸ì¡°í•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼
        ì¼ìœ¼í‚¤ëŠ” ì „í˜•ì ì¸ íŒ¨í„´ì„ ì‹œì—°í•©ë‹ˆë‹¤. í¬ë¡¬ ê°œë°œì ë„êµ¬ì˜ Memory
        í”„ë¡œíŒŒì¼ëŸ¬ë¡œ Detached DOM ë…¸ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>

    <div class="controls">
      <h3>ì»¨íŠ¸ë¡¤</h3>
      <button id="createBtn">ë…¸ë“œ ìƒì„± ë° ì œê±° (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜)</button>
      <button id="createMultipleBtn">10ê°œ ë…¸ë“œ ìƒì„± ë° ì œê±°</button>
      <button class="danger" id="clearBtn">ì°¸ì¡° ë°°ì—´ ë¹„ìš°ê¸° (ëˆ„ìˆ˜ í•´ê²°)</button>
      <button class="success" id="viewBtn">ì°¸ì¡° ë°°ì—´ í™•ì¸</button>
    </div>

    <div class="stats">
      <h3>í†µê³„</h3>
      <p>ìƒì„±ëœ ë…¸ë“œ ìˆ˜: <strong id="nodeCount">0</strong></p>
      <p>
        ì°¸ì¡° ë°°ì—´ í¬ê¸°: <strong id="arraySize">0</strong>
        (ë©”ëª¨ë¦¬ì— ë‚¨ì•„ìˆëŠ” Detached ë…¸ë“œ)
      </p>
    </div>

    <div id="container">
      <p style="color: #6c757d">
        ì—¬ê¸°ì— ë…¸ë“œê°€ ìƒì„±ë˜ì—ˆë‹¤ê°€ ì œê±°ë©ë‹ˆë‹¤...
      </p>
    </div>

    <div class="warning">
      <h3>ğŸ“‹ Memory Profilerë¡œ í™•ì¸í•˜ëŠ” ë°©ë²•</h3>
      <ol>
        <li>
          í¬ë¡¬ ê°œë°œì ë„êµ¬ë¥¼ ì—½ë‹ˆë‹¤ (F12 ë˜ëŠ” Cmd/Ctrl+Opt+I)
        </li>
        <li>
          <strong>Memory</strong> íƒ­ì„ ì„ íƒí•©ë‹ˆë‹¤
        </li>
        <li>
          "Heap snapshot"ì„ ì„ íƒí•˜ê³  <code>Take snapshot</code> ë²„íŠ¼ì„
          í´ë¦­í•©ë‹ˆë‹¤ (Snapshot 1)
        </li>
        <li>
          ìœ„ì˜ "10ê°œ ë…¸ë“œ ìƒì„± ë° ì œê±°" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤
        </li>
        <li>
          ë‹¤ì‹œ <code>Take snapshot</code> ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤ (Snapshot 2)
        </li>
        <li>
          Snapshot 2ë¥¼ ì„ íƒí•˜ê³ , ê²€ìƒ‰ì°½ì— <code>Detached</code>ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤
        </li>
        <li>
          <strong>Detached HTMLDivElement</strong> í•­ëª©ì„ ì°¾ì•„ í¼ì³ë´…ë‹ˆë‹¤
        </li>
        <li>
          Detached ë…¸ë“œë¥¼ í´ë¦­í•˜ë©´ í•˜ë‹¨ì— <strong>Retainers</strong> íŒ¨ë„ì´
          ë‚˜íƒ€ë‚©ë‹ˆë‹¤
        </li>
        <li>
          Retainer ê²½ë¡œë¥¼ ë”°ë¼ê°€ë©´ <code>detachedNodes</code> ë°°ì—´ì´ ì´ ë…¸ë“œë¥¼
          ì°¸ì¡°í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
        </li>
      </ol>
    </div>

    <div class="info">
      <h3>ğŸ§¹ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í•´ê²° í™•ì¸í•˜ê¸°</h3>
      <ol>
        <li>"ì°¸ì¡° ë°°ì—´ ë¹„ìš°ê¸°" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤</li>
        <li>
          ìƒˆë¡œìš´ Heap snapshotì„ ì°ìŠµë‹ˆë‹¤ (Snapshot 3)
        </li>
        <li>
          Snapshot 2ì™€ Snapshot 3ì„ ë¹„êµí•˜ë©´ Detached ë…¸ë“œê°€ ì‚¬ë¼ì§„ ê²ƒì„ í™•ì¸í• 
          ìˆ˜ ìˆìŠµë‹ˆë‹¤
        </li>
        <li>
          ë˜ëŠ” Snapshot 3ì—ì„œ "Detached"ë¥¼ ê²€ìƒ‰í•˜ë©´ ì´ì œ ê±°ì˜ ì—†ê±°ë‚˜ í¬ê²Œ
          ì¤„ì–´ë“  ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
        </li>
      </ol>
    </div>

    <script>
      // âŒ ë‚˜ìœ ì˜ˆ: DOMì—ì„œ ì œê±°ëœ ë…¸ë“œë¥¼ ë°°ì—´ì— ì €ì¥í•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ
      let detachedNodes = []
      let nodeCounter = 0

      const container = document.getElementById('container')
      const nodeCountEl = document.getElementById('nodeCount')
      const arraySizeEl = document.getElementById('arraySize')

      function updateStats() {
        nodeCountEl.textContent = nodeCounter
        arraySizeEl.textContent = detachedNodes.length
      }

      // ë…¸ë“œ ìƒì„± ë° ì œê±° (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ)
      function createAndDetachNode() {
        nodeCounter++

        // 1. DOM ë…¸ë“œ ìƒì„±
        const div = document.createElement('div')
        div.className = 'node-item'
        div.innerHTML = `
          <h4>ë…¸ë“œ #${nodeCounter}</h4>
          <p>ì´ ë…¸ë“œëŠ” ê³§ DOMì—ì„œ ì œê±°ë˜ì§€ë§Œ, ìë°”ìŠ¤í¬ë¦½íŠ¸ ë°°ì—´ì—ëŠ” ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.</p>
          <p>ìƒì„± ì‹œê°„: ${new Date().toLocaleTimeString()}</p>
        `

        // 2. DOMì— ì¶”ê°€
        container.appendChild(div)

        // 3. ì ì‹œ í›„ DOMì—ì„œ ì œê±° (í•˜ì§€ë§Œ detachedNodes ë°°ì—´ì—ëŠ” ì°¸ì¡° ìœ ì§€!)
        setTimeout(() => {
          if (div.parentNode) {
            container.removeChild(div)
          }

          // âŒ ë¬¸ì œ: DOMì—ì„œ ì œê±°í–ˆì§€ë§Œ ë°°ì—´ì— ì €ì¥í•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ
          detachedNodes.push(div)
          updateStats()

          console.log(
            `%cë…¸ë“œ #${nodeCounter}ê°€ DOMì—ì„œ ì œê±°ë˜ì—ˆì§€ë§Œ detachedNodes ë°°ì—´ì— ë‚¨ì•„ìˆìŠµë‹ˆë‹¤!`,
            'color: red; font-weight: bold',
          )
        }, 500)
      }

      // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById('createBtn').addEventListener('click', () => {
        createAndDetachNode()
      })

      document.getElementById('createMultipleBtn').addEventListener('click', () => {
        console.log('%c10ê°œ ë…¸ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤...', 'color: blue; font-weight: bold')
        for (let i = 0; i < 10; i++) {
          setTimeout(() => createAndDetachNode(), i * 100)
        }
      })

      // âœ… í•´ê²°: ì°¸ì¡° ë°°ì—´ ë¹„ìš°ê¸°
      document.getElementById('clearBtn').addEventListener('click', () => {
        const count = detachedNodes.length
        detachedNodes = []
        updateStats()

        console.log(
          `%câœ… ì°¸ì¡° ë°°ì—´ì„ ë¹„ì› ìŠµë‹ˆë‹¤! ${count}ê°œì˜ Detached ë…¸ë“œê°€ ì´ì œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ëŒ€ìƒì´ ë©ë‹ˆë‹¤.`,
          'color: green; font-weight: bold',
        )

        alert(
          `ì°¸ì¡° ë°°ì—´ì„ ë¹„ì› ìŠµë‹ˆë‹¤!\n\nì´ì œ Memory Profilerì—ì„œ ìƒˆë¡œìš´ Heap snapshotì„ ì°ì–´ë³´ì„¸ìš”.\nDetached DOM ë…¸ë“œê°€ ì‚¬ë¼ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
        )
      })

      // ë°°ì—´ ë‚´ìš© í™•ì¸
      document.getElementById('viewBtn').addEventListener('click', () => {
        console.log('detachedNodes ë°°ì—´ ë‚´ìš©:', detachedNodes)
        console.log('ë°°ì—´ í¬ê¸°:', detachedNodes.length)

        if (detachedNodes.length === 0) {
          alert('ì°¸ì¡° ë°°ì—´ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.')
        } else {
          alert(
            `ì°¸ì¡° ë°°ì—´ì— ${detachedNodes.length}ê°œì˜ Detached ë…¸ë“œê°€ ìˆìŠµë‹ˆë‹¤.\n\nì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.`,
          )
        }
      })

      // ì´ˆê¸° í†µê³„ ì—…ë°ì´íŠ¸
      updateStats()

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€
      console.log(
        '%cğŸ” Detached DOM Nodes í…ŒìŠ¤íŠ¸ ì‹œì‘',
        'color: blue; font-size: 16px; font-weight: bold',
      )
      console.log(
        '%cìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ Detached DOM ë…¸ë“œë¥¼ ìƒì„±í•˜ê³ , Memory Profilerë¡œ í™•ì¸í•´ë³´ì„¸ìš”!',
        'color: gray',
      )
    </script>
  </body>
</html>
