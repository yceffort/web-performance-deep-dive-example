<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EventListener ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì˜ˆì œ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        padding: 2rem;
        background: #f5f5f5;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        margin-bottom: 1rem;
      }

      .info {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 1rem;
        margin-bottom: 2rem;
        border-radius: 4px;
      }

      .info h3 {
        color: #1976d2;
        margin-bottom: 0.5rem;
      }

      .info ol {
        margin-left: 1.5rem;
        color: #555;
      }

      .info li {
        margin-bottom: 0.5rem;
      }

      .controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      button {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #2196f3;
        color: white;
      }

      .btn-primary:hover {
        background: #1976d2;
      }

      .btn-danger {
        background: #f44336;
        color: white;
      }

      .btn-danger:hover {
        background: #d32f2f;
      }

      .btn-secondary {
        background: #607d8b;
        color: white;
      }

      .btn-secondary:hover {
        background: #455a64;
      }

      .stats {
        background: #f5f5f5;
        padding: 1rem;
        border-radius: 4px;
        margin-bottom: 2rem;
      }

      .stats p {
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
      }

      .stats strong {
        color: #2196f3;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        max-width: 500px;
        width: 90%;
      }

      .modal h2 {
        margin-bottom: 1rem;
        color: #333;
      }

      .modal p {
        color: #666;
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }

      .modal input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        margin-bottom: 1rem;
      }

      .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
      }

      .warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 1rem;
        margin-top: 2rem;
        border-radius: 4px;
      }

      .warning strong {
        color: #f57c00;
      }

      code {
        background: #f5f5f5;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ› EventListener ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì˜ˆì œ</h1>

      <div class="info">
        <h3>ğŸ“‹ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë””ë²„ê¹… ë°©ë²•</h3>
        <ol>
          <li>Chrome DevToolsë¥¼ ì—½ë‹ˆë‹¤ (F12 ë˜ëŠ” Cmd+Option+I)</li>
          <li>Memory íƒ­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤</li>
          <li>"Heap snapshot"ì„ ì„ íƒí•˜ê³  <strong>ì²« ë²ˆì§¸ ìŠ¤ëƒ…ìƒ·</strong>ì„ ì°ìŠµë‹ˆë‹¤</li>
          <li>"ëª¨ë‹¬ 10ë²ˆ ì—´ê³  ë‹«ê¸°" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤</li>
          <li><strong>ë‘ ë²ˆì§¸ ìŠ¤ëƒ…ìƒ·</strong>ì„ ì°ìŠµë‹ˆë‹¤</li>
          <li>ë‘ ë²ˆì§¸ ìŠ¤ëƒ…ìƒ·ì„ ì„ íƒí•˜ê³  "Comparison" ë·°ë¡œ ì „í™˜í•©ë‹ˆë‹¤</li>
          <li>"# Delta" ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ EventListenerê°€ +10 ì¦ê°€í•œ ê²ƒì„ í™•ì¸í•©ë‹ˆë‹¤</li>
          <li>EventListener í•­ëª©ì„ ì„ íƒí•˜ê³  í•˜ë‹¨ì˜ Retainers íŒ¨ë„ì—ì„œ ì°¸ì¡° ì²´ì¸ì„ í™•ì¸í•©ë‹ˆë‹¤</li>
        </ol>
      </div>

      <div class="controls">
        <button class="btn-primary" onclick="openModal()">ê²€ìƒ‰ ëª¨ë‹¬ ì—´ê¸°</button>
        <button class="btn-danger" onclick="openModalMultipleTimes(10)">
          ëª¨ë‹¬ 10ë²ˆ ì—´ê³  ë‹«ê¸°
        </button>
        <button class="btn-secondary" onclick="location.reload()">í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
      </div>

      <div class="stats">
        <p><strong>ëª¨ë‹¬ ì—´ê¸° íšŸìˆ˜:</strong> <span id="openCount">0</span></p>
        <p>
          <strong>ì˜ˆìƒ ëˆ„ìˆ˜ëœ EventListener:</strong>
          <span id="leakedListeners">0</span>
        </p>
      </div>

      <div class="warning">
        <p>
          <strong>âš ï¸ ë¬¸ì œ:</strong> ì´ ì½”ë“œëŠ” ëª¨ë‹¬ì„ ì—´ ë•Œë§ˆë‹¤ <code>keydown</code> ì´ë²¤íŠ¸
          ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•˜ì§€ë§Œ, ëª¨ë‹¬ì„ ë‹«ì„ ë•Œ ì œê±°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë‹¬ì„ 10ë²ˆ ì—´ë©´ 10ê°œì˜
          ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë©”ëª¨ë¦¬ì— ë‚¨ê²Œ ë©ë‹ˆë‹¤.
        </p>
      </div>
    </div>

    <script>
      let openCount = 0
      let currentHandler = null

      // âŒ ë¬¸ì œê°€ ìˆëŠ” ì½”ë“œ: cleanupì„ í•˜ì§€ ì•ŠìŒ
      function openModal() {
        openCount++
        updateStats()

        const overlay = createModalElement()
        document.body.appendChild(overlay)

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•˜ì§€ë§Œ ì œê±°í•˜ì§€ ì•ŠìŒ!
        function handleKeyDown(e) {
          if (e.key === 'Escape') {
            closeModal(overlay)
          }
        }

        // ì—¬ê¸°ê°€ ë¬¸ì œ! removeEventListenerë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
        window.addEventListener('keydown', handleKeyDown)

        // ì°¸ì¡°ë¥¼ ì €ì¥ (ë””ë²„ê¹…ìš©)
        currentHandler = handleKeyDown
      }

      function createModalElement() {
        const overlay = document.createElement('div')
        overlay.className = 'modal-overlay'

        overlay.innerHTML = `
          <div class="modal">
            <h2>ğŸ” ê²€ìƒ‰ ëª¨ë‹¬</h2>
            <p>ESC í‚¤ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ë‹«ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ëª¨ë‹¬ì„ ë‹«ìœ¼ì„¸ìš”.</p>
            <input type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autofocus />
            <div class="modal-actions">
              <button class="btn-secondary" onclick="closeModal(this.closest('.modal-overlay'))">
                ë‹«ê¸°
              </button>
            </div>
          </div>
        `

        overlay.addEventListener('click', (e) => {
          if (e.target === overlay) {
            closeModal(overlay)
          }
        })

        return overlay
      }

      function closeModal(overlay) {
        if (overlay && overlay.parentNode) {
          overlay.parentNode.removeChild(overlay)
        }
        // âŒ ì—¬ê¸°ì„œ window.removeEventListener('keydown', handleKeyDown)ë¥¼ í˜¸ì¶œí•´ì•¼ í•˜ì§€ë§Œ í•˜ì§€ ì•ŠìŒ!
      }

      function updateStats() {
        document.getElementById('openCount').textContent = openCount
        document.getElementById('leakedListeners').textContent = openCount
      }

      // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë¹ ë¥´ê²Œ ì¬í˜„í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
      async function openModalMultipleTimes(count) {
        for (let i = 0; i < count; i++) {
          openModal()
          await sleep(100) // 100ms ëŒ€ê¸°
          const overlay = document.querySelector('.modal-overlay')
          if (overlay) {
            closeModal(overlay)
          }
          await sleep(100) // 100ms ëŒ€ê¸°
        }

        alert(
          `âœ… ëª¨ë‹¬ì„ ${count}ë²ˆ ì—´ê³  ë‹«ì•˜ìŠµë‹ˆë‹¤.\n\n` +
            `ì§€ê¸ˆ Memory íƒ­ì—ì„œ ë‘ ë²ˆì§¸ Heap snapshotì„ ì°ê³ ,\n` +
            `Comparison ë·°ì—ì„œ EventListenerì˜ # Deltaê°€ +${count}ì¸ì§€ í™•ì¸í•˜ì„¸ìš”!`
        )
      }

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms))
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´
      window.addEventListener('load', () => {
        console.log('ğŸ› EventListener ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì˜ˆì œ')
        console.log('ğŸ“‹ ë””ë²„ê¹… ìˆœì„œ:')
        console.log('1. DevTools > Memory íƒ­ > Heap snapshot ì°ê¸°')
        console.log('2. "ëª¨ë‹¬ 10ë²ˆ ì—´ê³  ë‹«ê¸°" ë²„íŠ¼ í´ë¦­')
        console.log('3. ë‹¤ì‹œ Heap snapshot ì°ê¸°')
        console.log('4. Comparison ë·°ë¡œ ì „í™˜')
        console.log('5. # Delta ê¸°ì¤€ ì •ë ¬í•˜ì—¬ EventListener +10 í™•ì¸')
        console.log('6. EventListener ì„ íƒ í›„ Retainers íŒ¨ë„ì—ì„œ ì°¸ì¡° ì²´ì¸ í™•ì¸')
      })
    </script>
  </body>
</html>
