<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speculation Rules API Demo</title>
    <link rel="stylesheet" href="styles.css" />

    <!-- Speculation Rules: ë¬¸ì„œ ê·œì¹™ -->
    <script type="speculationrules">
      {
        "prefetch": [
          {
            "source": "document",
            "where": {
              "selector_matches": ".prefetch-link"
            },
            "eagerness": "eager"
          }
        ],
        "prerender": [
          {
            "source": "document",
            "where": {
              "selector_matches": ".prerender-link"
            },
            "eagerness": "eager"
          }
        ]
      }
    </script>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>Speculation Rules API Demo</h1>
        <p class="subtitle">prefetchì™€ prerenderë¡œ ì¦‰ê°ì ì¸ í˜ì´ì§€ ì „í™˜ ì²´í—˜</p>
      </header>

      <main class="main">
        <section class="info-box">
          <h2>í…ŒìŠ¤íŠ¸ ë°©ë²•</h2>
          <ol>
            <li>Chrome DevTools â†’ Network íƒ­ ì—´ê¸°</li>
            <li>ì•„ë˜ ë§í¬ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”</li>
            <li>Network íƒ­ì—ì„œ prefetch/prerender ìš”ì²­ í™•ì¸</li>
            <li>í´ë¦­í•˜ë©´ ì¦‰ì‹œ í˜ì´ì§€ê°€ ë¡œë“œë©ë‹ˆë‹¤</li>
          </ol>
        </section>

        <section class="link-section">
          <h2>Prefetch ë§í¬</h2>
          <p class="description">
            hover ì‹œ HTMLë§Œ ë¯¸ë¦¬ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤. í´ë¦­í•˜ë©´ ìºì‹œëœ HTMLì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
          </p>
          <div class="link-grid">
            <a href="article-1.html" class="card prefetch-link">
              <span class="badge prefetch">prefetch</span>
              <h3>ì›¹ ì„±ëŠ¥ ìµœì í™” ê¸°ì´ˆ</h3>
              <p>Core Web Vitalsì™€ ì„±ëŠ¥ ì¸¡ì • ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.</p>
            </a>
            <a href="article-2.html" class="card prefetch-link">
              <span class="badge prefetch">prefetch</span>
              <h3>ì´ë¯¸ì§€ ìµœì í™” ì „ëµ</h3>
              <p>WebP, AVIF í¬ë§·ê³¼ ë°˜ì‘í˜• ì´ë¯¸ì§€ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.</p>
            </a>
          </div>
        </section>

        <section class="link-section">
          <h2>Prerender ë§í¬</h2>
          <p class="description">
            hover ì‹œ í˜ì´ì§€ ì „ì²´ë¥¼ ë¯¸ë¦¬ ë Œë”ë§í•©ë‹ˆë‹¤. í´ë¦­í•˜ë©´ ì¦‰ì‹œ í‘œì‹œë©ë‹ˆë‹¤.
          </p>
          <div class="link-grid">
            <a href="article-3.html" class="card prerender-link">
              <span class="badge prerender">prerender</span>
              <h3>JavaScript ë²ˆë“¤ ìµœì í™”</h3>
              <p>ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ê³¼ íŠ¸ë¦¬ ì‰ì´í‚¹ì„ ì‹¤ìŠµí•©ë‹ˆë‹¤.</p>
            </a>
            <a href="article-4.html" class="card prerender-link">
              <span class="badge prerender">prerender</span>
              <h3>ìºì‹± ì „ëµ ë§ˆìŠ¤í„°</h3>
              <p>ë¸Œë¼ìš°ì € ìºì‹œì™€ CDN í™œìš©ë²•ì„ ë°°ì›ë‹ˆë‹¤.</p>
            </a>
          </div>
        </section>

        <section class="link-section">
          <h2>ì¼ë°˜ ë§í¬ (ë¹„êµìš©)</h2>
          <p class="description">
            Speculation Rulesê°€ ì ìš©ë˜ì§€ ì•Šì€ ì¼ë°˜ ë§í¬ì…ë‹ˆë‹¤.
          </p>
          <div class="link-grid">
            <a href="article-5.html" class="card normal-link">
              <span class="badge normal">normal</span>
              <h3>ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§</h3>
              <p>SSRê³¼ í•˜ì´ë“œë ˆì´ì…˜ì„ ì´í•´í•©ë‹ˆë‹¤.</p>
            </a>
          </div>
        </section>
      </main>

      <footer class="footer">
        <p class="support-status"></p>
        <p>Speculation Rules API Demo - Chrome 109+ ì§€ì›</p>
      </footer>
    </div>

    <script>
      const supportStatus = document.querySelector('.support-status')
      if (HTMLScriptElement.supports && HTMLScriptElement.supports('speculationrules')) {
        supportStatus.textContent = 'âœ… ì´ ë¸Œë¼ìš°ì €ëŠ” Speculation Rules APIë¥¼ ì§€ì›í•©ë‹ˆë‹¤.'
        supportStatus.style.color = '#22c55e'
      } else {
        supportStatus.textContent = 'âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” Speculation Rules APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome 109+ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.'
        supportStatus.style.color = '#ef4444'
      }

      // Speculation ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
      const debugLog = document.createElement('div')
      debugLog.id = 'debug-log'
      debugLog.style.cssText = 'position:fixed;bottom:10px;right:10px;background:#1a1a2e;color:#fff;padding:12px;border-radius:8px;font-size:12px;max-width:300px;z-index:9999;font-family:monospace;'
      debugLog.innerHTML = '<strong>ğŸ” Speculation Debug</strong><br>'
      document.body.appendChild(debugLog)

      // ë§í¬ hover ì´ë²¤íŠ¸ ê°ì§€
      document.querySelectorAll('.prefetch-link, .prerender-link').forEach(link => {
        link.addEventListener('pointerenter', () => {
          const type = link.classList.contains('prerender-link') ? 'prerender' : 'prefetch'
          const url = link.getAttribute('href')
          debugLog.innerHTML += `<br>ğŸ¯ ${type}: ${url}`

          // 3ì´ˆ í›„ ë©”ì‹œì§€ ì •ë¦¬
          setTimeout(() => {
            const lines = debugLog.innerHTML.split('<br>')
            if (lines.length > 5) {
              debugLog.innerHTML = lines.slice(0, 1).concat(lines.slice(-4)).join('<br>')
            }
          }, 3000)
        })
      })

      // PerformanceObserverë¡œ ë¦¬ì†ŒìŠ¤ ë¡œë”© ê°ì§€
      if (window.PerformanceObserver) {
        const observer = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (entry.initiatorType === 'fetch' || entry.name.includes('article')) {
              debugLog.innerHTML += `<br>ğŸ“¥ loaded: ${entry.name.split('/').pop()}`
            }
          }
        })
        observer.observe({ entryTypes: ['resource'] })
      }
    </script>
  </body>
</html>
