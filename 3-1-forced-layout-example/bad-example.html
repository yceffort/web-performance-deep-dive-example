<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‚˜ìœ ì˜ˆ: ê°•ì œ ë™ê¸° ë ˆì´ì•„ì›ƒ (Forced Synchronous Layout)</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }

      .header {
        background: #ff6b6b;
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .info {
        background: #fff3cd;
        border: 2px solid #ffc107;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .controls {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      button {
        background: #ff6b6b;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
      }

      button:hover {
        background: #ee5a5a;
      }

      .container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
      }

      .box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        font-weight: bold;
        transition: transform 0.2s;
      }

      .box:hover {
        transform: scale(1.05);
      }

      .result {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .result h3 {
        margin-top: 0;
        color: #ff6b6b;
      }

      .metric {
        font-size: 24px;
        font-weight: bold;
        color: #ff6b6b;
        margin: 10px 0;
      }

      code {
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Monaco', 'Courier New', monospace;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>âš ï¸ ë‚˜ìœ ì˜ˆ: ê°•ì œ ë™ê¸° ë ˆì´ì•„ì›ƒ</h1>
      <p>DOM ì½ê¸°ì™€ ì“°ê¸°ë¥¼ ë°˜ë³µí•˜ì—¬ ë ˆì´ì•„ì›ƒì„ ê°•ì œë¡œ ì¬ê³„ì‚°í•©ë‹ˆë‹¤</p>
    </div>

    <div class="info">
      <strong>ğŸ“Š DevTools í™•ì¸ ë°©ë²•:</strong>
      <ol>
        <li>Chrome DevTools ì—´ê¸° (F12 ë˜ëŠ” Cmd+Option+I)</li>
        <li>Performance íƒ­ìœ¼ë¡œ ì´ë™</li>
        <li>"Start profiling and reload page" (âŸ³) ë²„íŠ¼ í´ë¦­</li>
        <li>
          Main ìŠ¤ë ˆë“œì—ì„œ "Recalculate Style"ê³¼ "Layout"ì´
          <strong>ë°˜ë³µ</strong>ë˜ëŠ” íŒ¨í„´ í™•ì¸
        </li>
        <li>
          ë³´ë¼ìƒ‰ ê²½ê³ : "Forced reflow is a likely performance bottleneck" í™•ì¸
        </li>
      </ol>
    </div>

    <div class="controls">
      <button onclick="runBadExample()">
        ğŸ”´ ê°•ì œ ë™ê¸° ë ˆì´ì•„ì›ƒ ì‹¤í–‰ (ë‚˜ìœ ì˜ˆ)
      </button>
      <p style="margin-top: 10px; color: #666">
        ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ 1000ê°œ ìš”ì†Œì˜ ë†’ì´ë¥¼ ì½ê³  ìˆ˜ì •í•©ë‹ˆë‹¤
      </p>
    </div>

    <div class="container" id="container"></div>

    <div class="result" id="result" style="display: none">
      <h3>ì‹¤í–‰ ê²°ê³¼</h3>
      <div>ì‹¤í–‰ ì‹œê°„: <span class="metric" id="duration">-</span></div>
      <div style="margin-top: 15px">
        <strong>ë¬¸ì œì :</strong>
        <ul>
          <li>
            ê° ìš”ì†Œë§ˆë‹¤ <code>offsetHeight</code> ì½ê¸° â†’ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚° ê°•ì œ
          </li>
          <li><code>style.height</code> ì“°ê¸° â†’ DOM ë³€ê²½</li>
          <li>ë‹¤ìŒ ìš”ì†Œì—ì„œ ë‹¤ì‹œ ì½ê¸° â†’ ë˜ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚°</li>
          <li>
            <strong>1000ë²ˆì˜ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚°</strong>ì´ ë°œìƒí•˜ì—¬ ë§¤ìš° ëŠë¦¼
          </li>
        </ul>
      </div>
    </div>

    <script>
      // 1000ê°œì˜ ë°•ìŠ¤ ìƒì„±
      const container = document.getElementById('container')
      const COUNT = 1000

      for (let i = 0; i < COUNT; i++) {
        const box = document.createElement('div')
        box.className = 'box'
        box.textContent = i + 1
        container.appendChild(box)
      }

      // ë‚˜ìœ ì˜ˆ: ê°•ì œ ë™ê¸° ë ˆì´ì•„ì›ƒ
      function runBadExample() {
        console.log('ğŸ”´ ë‚˜ìœ ì˜ˆ ì‹¤í–‰ ì‹œì‘')

        const elements = document.querySelectorAll('.box')
        const startTime = performance.now()

        // âš ï¸ ë‚˜ìœ íŒ¨í„´: DOM ì½ê¸°ì™€ ì“°ê¸°ë¥¼ ë°˜ë³µ
        elements.forEach((el) => {
          // DOM ì½ê¸° â†’ ë ˆì´ì•„ì›ƒ ê°•ì œ ì¬ê³„ì‚°!
          const height = el.offsetHeight

          // DOM ì“°ê¸°
          el.style.height = height + 10 + 'px'

          // ë‹¤ìŒ ë°˜ë³µì—ì„œ ë‹¤ì‹œ ì½ê¸° â†’ ë˜ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚°!
        })

        const endTime = performance.now()
        const duration = (endTime - startTime).toFixed(2)

        console.log(`ğŸ”´ ë‚˜ìœ ì˜ˆ ì‹¤í–‰ ì™„ë£Œ: ${duration}ms`)
        console.log(
          `âš ï¸ DevTools Performance íŒ¨ë„ì—ì„œ "Recalculate Style"ê³¼ "Layout"ì´ ${COUNT}ë²ˆ ë°˜ë³µë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì„¸ìš”!`,
        )

        // ê²°ê³¼ í‘œì‹œ
        document.getElementById('result').style.display = 'block'
        document.getElementById('duration').textContent = duration + 'ms'

        // ì‹œê°„ ì €ì¥ (ì¢‹ì€ ì˜ˆì‹œì™€ ë¹„êµí•˜ê¸° ìœ„í•´)
        localStorage.setItem('badExampleTime', duration)
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰ (DevToolsì—ì„œ í™•ì¸í•˜ê¸° ìœ„í•´)
      window.addEventListener('load', () => {
        console.log('='.repeat(50))
        console.log('ğŸ“Š ê°•ì œ ë™ê¸° ë ˆì´ì•„ì›ƒ ë°ëª¨')
        console.log('='.repeat(50))
        console.log('')
        console.log(
          'ğŸ‘‰ DevTools Performance íŒ¨ë„ì„ ì—´ê³  í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”',
        )
        console.log(
          'ğŸ‘‰ Main ìŠ¤ë ˆë“œì—ì„œ "Recalculate Style"ê³¼ "Layout"ì´ ë°˜ë³µë˜ëŠ” íŒ¨í„´ì„ í™•ì¸í•˜ì„¸ìš”',
        )
        console.log('')

        // ìë™ ì‹¤í–‰
        setTimeout(() => {
          runBadExample()
        }, 500)
      })
    </script>
  </body>
</html>
