<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Layout Thrashing ì„±ëŠ¥ ë¹„êµ</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; }
    .description {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.1s;
    }
    button:hover { transform: scale(1.02); }
    button:active { transform: scale(0.98); }
    .bad { background: #e74c3c; color: white; }
    .good { background: #27ae60; color: white; }
    .reset { background: #95a5a6; color: white; }
    label {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    input[type="number"] {
      width: 100px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .results {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    .result-item:last-child { border-bottom: none; }
    .time { font-weight: bold; font-size: 18px; }
    .time.bad-time { color: #e74c3c; }
    .time.good-time { color: #27ae60; }
    .comparison {
      background: #3498db;
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-size: 18px;
      margin-top: 10px;
    }
    .box-container {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-height: 400px;
      overflow: auto;
    }
    .box {
      width: 30px;
      height: 30px;
      background: #3498db;
      border-radius: 4px;
      transition: none;
    }
    .tip {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .tip strong { color: #856404; }
  </style>
</head>
<body>
  <h1>Layout Thrashing ì„±ëŠ¥ ë¹„êµ</h1>

  <div class="description">
    <h3>Layout Thrashingì´ë€?</h3>
    <p>DOMì„ ì½ê³ (offsetHeight) ì“°ëŠ”(style.height) ì‘ì—…ì„ ë°˜ë³µí•˜ë©´, ë¸Œë¼ìš°ì €ëŠ” ë§¤ë²ˆ ë ˆì´ì•„ì›ƒì„ ë‹¤ì‹œ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤.</p>
    <ul>
      <li><strong>ë‚˜ìœ ì˜ˆ</strong>: ì½ê¸° â†’ ì“°ê¸° â†’ ì½ê¸° â†’ ì“°ê¸°... (Në²ˆì˜ ë ˆì´ì•„ì›ƒ ê³„ì‚°)</li>
      <li><strong>ì¢‹ì€ ì˜ˆ</strong>: ì½ê¸° â†’ ì½ê¸° â†’ ... â†’ ì“°ê¸° â†’ ì“°ê¸°... (1ë²ˆì˜ ë ˆì´ì•„ì›ƒ ê³„ì‚°)</li>
    </ul>
  </div>

  <div class="tip">
    <strong>ğŸ’¡ DevToolsì—ì„œ í™•ì¸í•˜ê¸°:</strong> Performance íƒ­ì—ì„œ "Recalculate Style"ê³¼ "Layout" ì´ë²¤íŠ¸ê°€ ì–¼ë§ˆë‚˜ ë°˜ë³µë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
  </div>

  <div class="controls">
    <label>
      ë°•ìŠ¤ ê°œìˆ˜:
      <input type="number" id="boxCount" value="500" min="100" max="5000" step="100">
    </label>
    <button class="reset" onclick="resetBoxes()">ë°•ìŠ¤ ìƒì„±/ë¦¬ì…‹</button>
    <button class="bad" onclick="runBadExample()">ë‚˜ìœ ì˜ˆ ì‹¤í–‰</button>
    <button class="good" onclick="runGoodExample()">ì¢‹ì€ ì˜ˆ ì‹¤í–‰</button>
  </div>

  <div class="results">
    <h3>ì‹¤í–‰ ê²°ê³¼</h3>
    <div class="result-item">
      <span>ë‚˜ìœ ì˜ˆ (ì½ê¸°/ì“°ê¸° ë°˜ë³µ)</span>
      <span class="time bad-time" id="badTime">-</span>
    </div>
    <div class="result-item">
      <span>ì¢‹ì€ ì˜ˆ (ì½ê¸°/ì“°ê¸° ë¶„ë¦¬)</span>
      <span class="time good-time" id="goodTime">-</span>
    </div>
    <div class="comparison" id="comparison" style="display: none;"></div>
  </div>

  <div class="box-container" id="container"></div>

  <script>
    let boxes = [];

    function resetBoxes() {
      const count = parseInt(document.getElementById('boxCount').value);
      const container = document.getElementById('container');
      container.innerHTML = '';
      boxes = [];

      for (let i = 0; i < count; i++) {
        const box = document.createElement('div');
        box.className = 'box';
        box.style.height = '30px';
        container.appendChild(box);
        boxes.push(box);
      }

      document.getElementById('badTime').textContent = '-';
      document.getElementById('goodTime').textContent = '-';
      document.getElementById('comparison').style.display = 'none';
    }

    function runBadExample() {
      if (boxes.length === 0) {
        alert('ë¨¼ì € ë°•ìŠ¤ë¥¼ ìƒì„±í•˜ì„¸ìš”!');
        return;
      }

      // ë°•ìŠ¤ ë†’ì´ ë¦¬ì…‹
      boxes.forEach(box => box.style.height = '30px');

      // ê°•ì œ ë¦¬í”Œë¡œìš°
      void document.body.offsetHeight;

      const start = performance.now();

      // ë‚˜ìœ ì˜ˆ: ì½ê¸°ì™€ ì“°ê¸°ë¥¼ ë°˜ë³µ
      boxes.forEach((box) => {
        const height = box.offsetHeight;  // ì½ê¸° (ë ˆì´ì•„ì›ƒ ê³„ì‚° ìœ ë°œ)
        box.style.height = height + 1 + 'px';  // ì“°ê¸° (ë ˆì´ì•„ì›ƒ ë¬´íš¨í™”)
      });

      const end = performance.now();
      const time = (end - start).toFixed(2);
      document.getElementById('badTime').textContent = time + 'ms';
      updateComparison();
    }

    function runGoodExample() {
      if (boxes.length === 0) {
        alert('ë¨¼ì € ë°•ìŠ¤ë¥¼ ìƒì„±í•˜ì„¸ìš”!');
        return;
      }

      // ë°•ìŠ¤ ë†’ì´ ë¦¬ì…‹
      boxes.forEach(box => box.style.height = '30px');

      // ê°•ì œ ë¦¬í”Œë¡œìš°
      void document.body.offsetHeight;

      const start = performance.now();

      // ì¢‹ì€ ì˜ˆ: ëª¨ë“  ì½ê¸°ë¥¼ ë¨¼ì €, ëª¨ë“  ì“°ê¸°ë¥¼ ë‚˜ì¤‘ì—
      const heights = boxes.map((box) => box.offsetHeight);  // ëª¨ë“  ì½ê¸° ë¨¼ì €
      boxes.forEach((box, i) => {
        box.style.height = heights[i] + 1 + 'px';  // ëª¨ë“  ì“°ê¸° ë‚˜ì¤‘ì—
      });

      const end = performance.now();
      const time = (end - start).toFixed(2);
      document.getElementById('goodTime').textContent = time + 'ms';
      updateComparison();
    }

    function updateComparison() {
      const badTime = parseFloat(document.getElementById('badTime').textContent);
      const goodTime = parseFloat(document.getElementById('goodTime').textContent);

      if (!isNaN(badTime) && !isNaN(goodTime) && goodTime > 0) {
        const ratio = (badTime / goodTime).toFixed(1);
        const diff = (badTime - goodTime).toFixed(2);
        document.getElementById('comparison').textContent =
          `ì¢‹ì€ ì˜ˆê°€ ${ratio}ë°° ë¹ ë¦„ (${diff}ms ì ˆì•½)`;
        document.getElementById('comparison').style.display = 'block';
      }
    }

    // ì´ˆê¸° ë°•ìŠ¤ ìƒì„±
    resetBoxes();
  </script>
</body>
</html>
