<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>modulepreload 테스트 - 의존성 자동 다운로드 확인</title>

    <!-- chart.js만 modulepreload 선언 -->
    <!-- 의존성(chart-utils.js, chart-axis.js)도 자동으로 다운로드되는가? -->
    <link rel="modulepreload" href="/modules/chart.js" />

    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }
      pre {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
      }
      .info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>modulepreload 테스트</h1>

    <div class="info">
      <h2>테스트 목적</h2>
      <p>
        <code>&lt;link rel="modulepreload" href="/modules/chart.js"&gt;</code>로
        chart.js만 선언했을 때, 의존성인 chart-utils.js와 chart-axis.js도 자동으로
        다운로드되는지 확인
      </p>

      <h3>확인 방법</h3>
      <ol>
        <li>개발자 도구의 Network 탭 열기</li>
        <li>Disable cache 체크</li>
        <li>페이지 새로고침</li>
        <li>JS 파일 필터 적용</li>
        <li>
          modulepreload로 인해 chart.js, chart-utils.js, chart-axis.js가 모두
          즉시 다운로드되는지 확인
        </li>
      </ol>
    </div>

    <button id="loadChart">Chart 모듈 import 하기</button>

    <h2>콘솔 로그</h2>
    <pre id="log"></pre>

    <script type="module">
      const logElement = document.getElementById('log')
      const originalLog = console.log

      console.log = function (...args) {
        originalLog.apply(console, args)
        logElement.textContent += args.join(' ') + '\n'
      }

      console.log('=== 페이지 로드 완료 ===')
      console.log(
        'modulepreload가 선언되었으므로, chart.js가 미리 다운로드되었어야 함',
      )
      console.log(
        '만약 의존성도 자동으로 다운로드된다면, chart-utils.js와 chart-axis.js도 다운로드되었어야 함',
      )
      console.log('Network 탭을 확인하세요!')
      console.log('')

      document.getElementById('loadChart').addEventListener('click', async () => {
        console.log('=== Chart 모듈 import 시작 ===')

        const { Chart } = await import('./modules/chart.js')

        console.log('=== Chart 모듈 import 완료 ===')
        console.log('')

        const chart = new Chart([1, 2, 3, 4, 5])
        chart.render()
      })
    </script>
  </body>
</html>
