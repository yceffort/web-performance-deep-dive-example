<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>modulepreload ì˜ì¡´ì„± ìë™ fetch ê²€ì¦</title>

    <!-- chart.jsë§Œ modulepreload ì„ ì–¸ -->
    <link rel="modulepreload" href="/modules/chart.js" />

    <style>
      body {
        font-family: 'Monaco', 'Courier New', monospace;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #1e1e1e;
        color: #d4d4d4;
      }
      .header {
        background: #2d2d30;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #007acc;
      }
      h1 {
        margin: 0 0 10px 0;
        color: #4fc3f7;
      }
      .dependency-chain {
        background: #252526;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .dependency-chain h2 {
        color: #4fc3f7;
        margin-top: 0;
      }
      .chain {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        font-size: 14px;
        margin: 15px 0;
      }
      .module {
        padding: 8px 16px;
        background: #3e3e42;
        border-radius: 4px;
        border: 2px solid #555;
      }
      .module.root {
        border-color: #f44336;
        color: #ff6b6b;
      }
      .arrow {
        color: #888;
        font-size: 18px;
      }
      .test-section {
        background: #252526;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .test-section h2 {
        color: #4fc3f7;
        margin-top: 0;
      }
      button {
        padding: 12px 24px;
        font-size: 16px;
        cursor: pointer;
        background: #007acc;
        color: white;
        border: none;
        border-radius: 4px;
        font-family: inherit;
      }
      button:hover {
        background: #005a9e;
      }
      .status {
        background: #1e1e1e;
        padding: 15px;
        border-radius: 4px;
        margin-top: 15px;
        border: 1px solid #3e3e42;
      }
      .status-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px;
        margin: 4px 0;
        border-radius: 4px;
      }
      .status-item.loaded {
        background: #1a3a1a;
        border-left: 3px solid #4caf50;
      }
      .status-item.pending {
        background: #3a3a1a;
        border-left: 3px solid #ff9800;
      }
      .status-item.not-loaded {
        background: #3a1a1a;
        border-left: 3px solid #f44336;
      }
      .icon {
        font-size: 16px;
      }
      .log-section {
        background: #252526;
        padding: 20px;
        border-radius: 8px;
      }
      .log-section h2 {
        color: #4fc3f7;
        margin-top: 0;
      }
      pre {
        background: #1e1e1e;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        border: 1px solid #3e3e42;
        font-size: 13px;
        line-height: 1.5;
        max-height: 400px;
        overflow-y: auto;
      }
      .instruction {
        background: #2d3748;
        padding: 15px;
        border-radius: 4px;
        margin-top: 15px;
        border-left: 4px solid #ffd700;
      }
      .instruction h3 {
        margin-top: 0;
        color: #ffd700;
      }
      .instruction ol {
        margin: 10px 0;
        padding-left: 20px;
      }
      .instruction li {
        margin: 5px 0;
      }
      code {
        background: #3e3e42;
        padding: 2px 6px;
        border-radius: 3px;
        color: #ce9178;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ğŸ” modulepreload ì˜ì¡´ì„± ìë™ fetch ê²€ì¦</h1>
      <p>
        chart.jsë§Œ <code>&lt;link rel="modulepreload"&gt;</code>ë¡œ ì„ ì–¸í–ˆì„ ë•Œ,
        ì˜ì¡´ì„±(chart-utils.js, chart-axis.js, helpers.js)ë„ ìë™ìœ¼ë¡œ
        ë‹¤ìš´ë¡œë“œë˜ëŠ”ê°€?
      </p>
    </div>

    <div class="dependency-chain">
      <h2>ğŸ“¦ ì˜ì¡´ì„± ì²´ì¸</h2>
      <div class="chain">
        <div class="module root">chart.js</div>
        <span class="arrow">â†’</span>
        <div class="module">chart-utils.js</div>
        <span class="arrow">â†’</span>
        <div class="module">helpers.js</div>
      </div>
      <div class="chain">
        <div class="module root">chart.js</div>
        <span class="arrow">â†’</span>
        <div class="module">chart-axis.js</div>
      </div>
      <p style="margin-top: 15px; color: #888">
        ì´ 4ê°œ íŒŒì¼: chart.js (root), chart-utils.js (1ì°¨), chart-axis.js (1ì°¨),
        helpers.js (2ì°¨)
      </p>
    </div>

    <div class="test-section">
      <h2>âœ… í˜„ì¬ ìƒíƒœ</h2>
      <div class="status" id="status">
        <div class="status-item pending" id="status-chart">
          <span class="icon">â³</span>
          <span>chart.js - modulepreloadë¡œ ì„ ì–¸ë¨</span>
        </div>
        <div class="status-item pending" id="status-utils">
          <span class="icon">â“</span>
          <span>chart-utils.js - ìë™ fetch ì—¬ë¶€ í™•ì¸ ì¤‘</span>
        </div>
        <div class="status-item pending" id="status-helpers">
          <span class="icon">â“</span>
          <span>helpers.js - ìë™ fetch ì—¬ë¶€ í™•ì¸ ì¤‘</span>
        </div>
        <div class="status-item pending" id="status-axis">
          <span class="icon">â“</span>
          <span>chart-axis.js - ìë™ fetch ì—¬ë¶€ í™•ì¸ ì¤‘</span>
        </div>
      </div>

      <div class="instruction">
        <h3>ğŸ” ê²€ì¦ ë°©ë²•</h3>
        <ol>
          <li>ê°œë°œì ë„êµ¬(F12) â†’ Network íƒ­ ì—´ê¸°</li>
          <li>"Disable cache" ì²´í¬ë°•ìŠ¤ í™œì„±í™”</li>
          <li>JS í•„í„° ì ìš©</li>
          <li><strong>í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (Cmd+R ë˜ëŠ” Ctrl+R)</strong></li>
          <li>
            <strong>ë²„íŠ¼ í´ë¦­ ì—†ì´</strong> Network íƒ­ í™•ì¸:
            <ul>
              <li>âœ… chart.jsë§Œ ë‹¤ìš´ë¡œë“œ â†’ ì˜ì¡´ì„± ìë™ fetch <strong>ì•ˆë¨</strong></li>
              <li>
                âœ… chart.js, chart-utils.js, helpers.js, chart-axis.js ëª¨ë‘
                ë‹¤ìš´ë¡œë“œ â†’ ì˜ì¡´ì„± ìë™ fetch <strong>ë¨</strong>
              </li>
            </ul>
          </li>
          <li>Initiator ì»¬ëŸ¼ í™•ì¸: ëˆ„ê°€ ê° íŒŒì¼ì„ ìš”ì²­í–ˆëŠ”ì§€</li>
        </ol>
      </div>

      <button id="loadChart" style="margin-top: 20px">
        ğŸ“Š Chart ëª¨ë“ˆ import í•˜ê¸° (ë™ì  ë¡œë“œ)
      </button>
    </div>

    <div class="log-section">
      <h2>ğŸ“ ì½˜ì†” ë¡œê·¸</h2>
      <pre id="log"></pre>
    </div>

    <script type="module">
      const logElement = document.getElementById('log')
      const originalLog = console.log
      let loadTimestamp = Date.now()

      console.log = function (...args) {
        originalLog.apply(console, args)
        const time = ((Date.now() - loadTimestamp) / 1000).toFixed(3)
        logElement.textContent += `[+${time}s] ${args.join(' ')}\n`
        logElement.scrollTop = logElement.scrollHeight
      }

      console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œì‘')
      console.log(
        'ğŸ“Œ <link rel="modulepreload" href="/modules/chart.js"> ì„ ì–¸ë¨',
      )
      console.log('')
      console.log('â³ ì˜ì¡´ì„± ìë™ fetch ì—¬ë¶€ í™•ì¸ ì¤‘...')
      console.log('   - chart.jsëŠ” modulepreloadë¡œ ì¸í•´ ë‹¤ìš´ë¡œë“œ ì¤‘')
      console.log(
        '   - chart-utils.jsëŠ”? (chart.jsê°€ importí•˜ëŠ” 1ì°¨ ì˜ì¡´ì„±)',
      )
      console.log('   - helpers.jsëŠ”? (chart-utils.jsê°€ importí•˜ëŠ” 2ì°¨ ì˜ì¡´ì„±)')
      console.log('   - chart-axis.jsëŠ”? (chart.jsê°€ importí•˜ëŠ” 1ì°¨ ì˜ì¡´ì„±)')
      console.log('')
      console.log('ğŸ’¡ Network íƒ­ì„ í™•ì¸í•˜ì„¸ìš”!')
      console.log('   - ì§€ê¸ˆ 4ê°œ íŒŒì¼ì´ ëª¨ë‘ ë‹¤ìš´ë¡œë“œë˜ê³  ìˆìœ¼ë©´: âœ… ìë™ fetch ë¨')
      console.log('   - chart.jsë§Œ ë‹¤ìš´ë¡œë“œë˜ê³  ìˆìœ¼ë©´: âŒ ìë™ fetch ì•ˆë¨')
      console.log('')

      // ëª¨ë“ˆ ë¡œë“œ ê°ì§€
      const moduleLoadTimes = {}

      document.getElementById('loadChart').addEventListener('click', async () => {
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
        console.log('ğŸ¯ ì‚¬ìš©ìê°€ "Chart ëª¨ë“ˆ import" ë²„íŠ¼ í´ë¦­')
        console.log('âš¡ import("./modules/chart.js") ì‹¤í–‰ ì‹œì‘')
        console.log('')

        try {
          const { Chart } = await import('./modules/chart.js')

          console.log('')
          console.log('âœ… import() ì™„ë£Œ!')
          console.log('')
          console.log('ğŸ“Š Chart ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì¤‘...')

          const chart = new Chart([1, 2, 3, 4, 5])
          chart.render()

          // ìƒíƒœ ì—…ë°ì´íŠ¸
          document.getElementById('status-chart').className =
            'status-item loaded'
          document.getElementById('status-chart').innerHTML =
            '<span class="icon">âœ…</span><span>chart.js - ë¡œë“œë¨</span>'
          document.getElementById('status-utils').className =
            'status-item loaded'
          document.getElementById('status-utils').innerHTML =
            '<span class="icon">âœ…</span><span>chart-utils.js - ë¡œë“œë¨</span>'
          document.getElementById('status-helpers').className =
            'status-item loaded'
          document.getElementById('status-helpers').innerHTML =
            '<span class="icon">âœ…</span><span>helpers.js - ë¡œë“œë¨</span>'
          document.getElementById('status-axis').className = 'status-item loaded'
          document.getElementById('status-axis').innerHTML =
            '<span class="icon">âœ…</span><span>chart-axis.js - ë¡œë“œë¨</span>'
        } catch (error) {
          console.error('âŒ import() ì‹¤íŒ¨:', error)
        }
      })
    </script>
  </body>
</html>
