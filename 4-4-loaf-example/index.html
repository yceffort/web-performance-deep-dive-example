<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Long Animation Frames API Demo</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>Long Animation Frames (LoAF) API Demo</h1>
        <p class="subtitle">INP ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ” ê¸´ ì‘ì—…ì„ ê°ì§€í•˜ê³  ë””ë²„ê¹…í•˜ê¸°</p>
        <p class="support-status" id="support-status"></p>
      </header>

      <main class="main">
        <section class="info-box">
          <h2>LoAF APIë€?</h2>
          <p>
            Long Animation Frames APIëŠ” 50msë¥¼ ì´ˆê³¼í•˜ëŠ” ë Œë”ë§ ì‘ì—…ì„ ê°ì§€í•©ë‹ˆë‹¤.
            ê¸°ì¡´ Long Tasks APIì™€ ë‹¬ë¦¬ <strong>ìŠ¤í¬ë¦½íŠ¸ ì†ŒìŠ¤, í•¨ìˆ˜ëª…, ì‹¤í–‰ ì‹œê°„</strong>ê¹Œì§€ ì•Œ ìˆ˜ ìˆì–´
            INP ë¬¸ì œì˜ ì •í™•í•œ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </section>

        <section class="demo-section">
          <h2>ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸</h2>
          <p class="description">
            ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì˜ë„ì ìœ¼ë¡œ ê¸´ ì‘ì—…ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
            LoAF APIê°€ ì´ë¥¼ ê°ì§€í•˜ì—¬ ì•„ë˜ ë¡œê·¸ì— í‘œì‹œí•©ë‹ˆë‹¤.
          </p>

          <div class="button-grid">
            <button class="demo-btn slow" onclick="runSlowTask()">
              <span class="btn-icon">ğŸ¢</span>
              <span class="btn-label">ëŠë¦° ì‘ì—… (200ms)</span>
              <span class="btn-desc">ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹</span>
            </button>

            <button class="demo-btn very-slow" onclick="runVerySlowTask()">
              <span class="btn-icon">ğŸ¦¥</span>
              <span class="btn-label">ë§¤ìš° ëŠë¦° ì‘ì—… (500ms)</span>
              <span class="btn-desc">ì‹¬ê°í•œ INP ì˜í–¥</span>
            </button>

            <button class="demo-btn optimized" onclick="runOptimizedTask()">
              <span class="btn-icon">âš¡</span>
              <span class="btn-label">ìµœì í™”ëœ ì‘ì—…</span>
              <span class="btn-desc">yieldë¡œ ë¶„í•  ì‹¤í–‰</span>
            </button>

            <button class="demo-btn fast" onclick="runFastTask()">
              <span class="btn-icon">ğŸš€</span>
              <span class="btn-label">ë¹ ë¥¸ ì‘ì—… (10ms)</span>
              <span class="btn-desc">LoAF ë¯¸ê°ì§€</span>
            </button>
          </div>
        </section>

        <section class="log-section">
          <div class="log-header">
            <h2>LoAF ê°ì§€ ë¡œê·¸</h2>
            <button class="clear-btn" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
          </div>
          <div class="log-container" id="log-container">
            <p class="log-placeholder">ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ LoAF ê°ì§€ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
          </div>
        </section>

        <section class="code-section">
          <h2>LoAF ê°ì§€ ì½”ë“œ</h2>
          <pre><code>const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log('LoAF ê°ì§€:', {
      duration: entry.duration,           // ì „ì²´ í”„ë ˆì„ ì‹œê°„
      blockingDuration: entry.blockingDuration, // ë¸”ë¡œí‚¹ ì‹œê°„
      scripts: entry.scripts.map(s => ({
        name: s.name,                     // í•¨ìˆ˜ëª…
        source: s.sourceURL,              // ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼
        duration: s.duration              // ì‹¤í–‰ ì‹œê°„
      }))
    })
  }
})

observer.observe({ type: 'long-animation-frame', buffered: true })</code></pre>
        </section>
      </main>

      <footer class="footer">
        <p>Long Animation Frames API - Chrome 123+ ì§€ì›</p>
      </footer>
    </div>

    <script>
      // ë¸Œë¼ìš°ì € ì§€ì› í™•ì¸
      const supportStatus = document.getElementById('support-status')
      if (PerformanceObserver.supportedEntryTypes?.includes('long-animation-frame')) {
        supportStatus.textContent = 'âœ… ì´ ë¸Œë¼ìš°ì €ëŠ” LoAF APIë¥¼ ì§€ì›í•©ë‹ˆë‹¤.'
        supportStatus.style.color = '#22c55e'
      } else {
        supportStatus.textContent = 'âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” LoAF APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome 123+ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.'
        supportStatus.style.color = '#ef4444'
      }

      const logContainer = document.getElementById('log-container')
      let logCount = 0

      // LoAF Observer ì„¤ì •
      if (PerformanceObserver.supportedEntryTypes?.includes('long-animation-frame')) {
        const observer = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            logLoAF(entry)
          }
        })
        observer.observe({ type: 'long-animation-frame', buffered: true })
      }

      function logLoAF(entry) {
        logCount++
        const logItem = document.createElement('div')
        logItem.className = 'log-item'

        const severity = entry.duration > 200 ? 'critical' : entry.duration > 100 ? 'warning' : 'info'
        logItem.classList.add(severity)

        const scripts = entry.scripts.map(s => {
          const funcName = s.name || '(anonymous)'
          const source = s.sourceURL ? s.sourceURL.split('/').pop() : '(inline)'
          return `${funcName} (${source}) - ${Math.round(s.duration)}ms`
        }).join('<br>')

        logItem.innerHTML = `
          <div class="log-header-row">
            <span class="log-number">#${logCount}</span>
            <span class="log-time">${new Date().toLocaleTimeString()}</span>
          </div>
          <div class="log-metrics">
            <div class="metric">
              <span class="metric-label">Duration</span>
              <span class="metric-value ${severity}">${Math.round(entry.duration)}ms</span>
            </div>
            <div class="metric">
              <span class="metric-label">Blocking</span>
              <span class="metric-value">${Math.round(entry.blockingDuration)}ms</span>
            </div>
            <div class="metric">
              <span class="metric-label">Render</span>
              <span class="metric-value">${Math.round(entry.renderStart ? entry.duration - entry.renderStart + entry.startTime : 0)}ms</span>
            </div>
          </div>
          ${scripts ? `<div class="log-scripts"><strong>Scripts:</strong><br>${scripts}</div>` : ''}
        `

        // placeholder ì œê±°
        const placeholder = logContainer.querySelector('.log-placeholder')
        if (placeholder) placeholder.remove()

        logContainer.insertBefore(logItem, logContainer.firstChild)
      }

      function clearLog() {
        logContainer.innerHTML = '<p class="log-placeholder">ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ LoAF ê°ì§€ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>'
        logCount = 0
      }

      // ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹í•˜ëŠ” ì‘ì—…
      function blockMainThread(ms) {
        const start = performance.now()
        while (performance.now() - start < ms) {
          // ì˜ë„ì ìœ¼ë¡œ ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹
        }
      }

      // ëŠë¦° ì‘ì—… (200ms)
      function runSlowTask() {
        const btn = event.target.closest('button')
        btn.classList.add('running')

        blockMainThread(200)

        btn.classList.remove('running')
        btn.classList.add('done')
        setTimeout(() => btn.classList.remove('done'), 500)
      }

      // ë§¤ìš° ëŠë¦° ì‘ì—… (500ms)
      function runVerySlowTask() {
        const btn = event.target.closest('button')
        btn.classList.add('running')

        blockMainThread(500)

        btn.classList.remove('running')
        btn.classList.add('done')
        setTimeout(() => btn.classList.remove('done'), 500)
      }

      // ìµœì í™”ëœ ì‘ì—… - yieldë¡œ ë¶„í• 
      async function runOptimizedTask() {
        const btn = event.target.closest('button')
        btn.classList.add('running')

        // ì‘ì—…ì„ 50ms ì²­í¬ë¡œ ë¶„í• 
        const totalWork = 500
        const chunkSize = 40

        for (let i = 0; i < totalWork; i += chunkSize) {
          blockMainThread(chunkSize)
          // ë¸Œë¼ìš°ì €ì—ê²Œ ì œì–´ê¶Œ ì–‘ë³´
          await new Promise(r => setTimeout(r, 0))
        }

        btn.classList.remove('running')
        btn.classList.add('done')
        setTimeout(() => btn.classList.remove('done'), 500)
      }

      // ë¹ ë¥¸ ì‘ì—… (10ms) - LoAF ì„ê³„ê°’ ë¯¸ë§Œ
      function runFastTask() {
        const btn = event.target.closest('button')
        btn.classList.add('running')

        blockMainThread(10)

        btn.classList.remove('running')
        btn.classList.add('done')
        setTimeout(() => btn.classList.remove('done'), 500)
      }
    </script>
  </body>
</html>
